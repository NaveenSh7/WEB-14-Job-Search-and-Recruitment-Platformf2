const CONFIG = require('./config');
const { resetPublicIPCache } = require('./index');

let queue = [];

function flushQueue() {
  if (queue.length === 0 ) return;

  const logsToSend = [...queue];
  queue = [];

  fetch('https://saas-monitoring-system-server-2.onrender.com/api/logs', {
    method: 'POST',
    headers: {
  'Content-Type': 'application/json',
  'x-api-secret': CONFIG.secret, 
},
    body: JSON.stringify(logsToSend),
  })
  .then(
    ()=>{resetPublicIPCache();}
  )
  .catch(console.error);
}

setInterval(flushQueue, 10000);

 function addLog(log) {
  queue.push(log);
}
module.exports = {addLog}